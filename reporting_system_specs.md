# ðŸ–¼ï¸ å…’ç«¥åœ–ç‰‡ç”Ÿæˆå™¨ - æª¢èˆ‰èˆ‡å®‰å…¨æ©Ÿåˆ¶è¦æ ¼æ›¸ (v2.1)

æœ¬æ–‡ä»¶æè¿° Kids Vocabulary Generator çš„å…§å®¹æª¢èˆ‰ç³»çµ±ã€æª”æ¡ˆå°å­˜ç­–ç•¥èˆ‡ AI å®‰å…¨é˜²è­·æ©Ÿåˆ¶ã€‚

---

## 1. æª¢èˆ‰èˆ‡ä¸‹æž¶æ©Ÿåˆ¶ (Report & Ban)

### è§¸ç™¼æ¢ä»¶ (Trigger)
*   **ä½¿ç”¨è€…å›žå ±**ï¼šä½¿ç”¨è€…é»žé¸æª¢èˆ‰æŒ‰éˆ•ã€‚
*   **é–€æª»**ï¼šç´¯ç© **3 ç¥¨** (Votes >= 3) æª¢èˆ‰ã€‚
*   **ç¯„åœ**ï¼šé‡å°ã€Œå–®å­—ã€çš„æª¢èˆ‰ï¼ˆè¦–ç‚ºå°è©²æ¬¡ç”Ÿæˆçµæžœçš„æ•´é«”ä¸æ»¿æ„ï¼ŒåŒ…å«åœ–èˆ‡æ–‡ï¼‰ã€‚

### è™•ç†æµç¨‹ (Archive Process)
ç•¶æª¢æŸ¥åˆ°ç¥¨æ•¸é”æ¨™ (`banned`) æ™‚ï¼Œç³»çµ±åŸ·è¡Œ **ã€Œå®Œæ•´å°å­˜èˆ‡ç§»é™¤ã€ (Full Archive & Delete)** æµç¨‹ï¼š

1.  **è³‡æ–™åº«å°å­˜ (Database Archive)**
    *   **ä¾†æº**ï¼š`mnemonic_generations` (ä¸»è¦é›†åˆ)
    *   **ç›®æ¨™**ï¼š`mnemonic_generations_archive` (å°å­˜é›†åˆ)
    *   **å‹•ä½œ**ï¼šè¤‡è£½æ•´ç­†æ–‡ä»¶ï¼Œä¸¦åŠ ä¸Šä»¥ä¸‹ metadataï¼š
        *   `archived_at`: å°å­˜æ™‚é–“æˆ³è¨˜ (ISO String)
        *   `archive_reason`: `'community_report_ban'`
        *   `final_votes`: ç´¯ç©ç¸½ç¥¨æ•¸

2.  **æª”æ¡ˆæ¬ç§» (File Archive)**
    *   åˆ©ç”¨ GitHub API åŸ·è¡Œæª”æ¡ˆæ¬å®¶ã€‚
    *   **ä¾†æºè·¯å¾‘**ï¼š`public/library/[hash].jpg` (å…¬é–‹åœ–åº«)
    *   **ç›®æ¨™è·¯å¾‘**ï¼š`public/library/archive/[hash].jpg` (å°å­˜åœ–åº«)
    *   **æŠ€è¡“å¯¦ä½œ**ï¼šç”±æ–¼ GitHub API ç„¡ç›´æŽ¥ Move æŒ‡ä»¤ï¼ŒæŽ¡ `Copy` + `Delete` æ–¹å¼ç¢ºä¿åŽŸå­æ€§ã€‚
    *   **é€£çµæ›´æ–°**ï¼šå°å­˜çš„è³‡æ–™åº«ç´€éŒ„ä¸­ï¼Œåœ–ç‰‡é€£çµ (`github_url`) æœƒæ›´æ–°ç‚ºå°å­˜è·¯å¾‘ï¼Œä¿ç•™å¯è¿½æº¯æ€§ã€‚

3.  **ä¸»è³‡æ–™ç§»é™¤ (Main Data Deletion)**
    *   ç¢ºèªä¸Šè¿°å…©æ­¥æˆåŠŸå¾Œï¼Œ**åˆªé™¤** `mnemonic_generations` ä¸­çš„åŽŸå§‹ç´€éŒ„ã€‚
    *   **ç›®çš„**ï¼šå¼·åˆ¶ç³»çµ±å°‡è©²å–®å­—è¦–ç‚ºã€Œæœªç”Ÿæˆã€ï¼Œä¸‹æ¬¡ä½¿ç”¨è€…æŸ¥è©¢æ™‚è§¸ç™¼å…¨æ–°çš„ AI ç”Ÿæˆæµç¨‹ã€‚

---

## 2. AI å…§å®¹å®‰å…¨é˜²è­· (Content Safety Guardrails)

ç‚ºé˜²æ­¢ AI ç”Ÿæˆææ€–ã€éŽåº¦å¯«å¯¦æˆ–ä¸é©åˆå…’ç«¥çš„å…§å®¹ï¼Œåœ¨ V2 ç”Ÿæˆæµç¨‹ä¸­å¯¦æ–½ä»¥ä¸‹å¼·åˆ¶æŽªæ–½ã€‚

### æç¤ºè©žè­·æ¬„ (Prompt Suffix)
åœ¨ LLM åˆ†æžå®Œå–®å­—ä¸¦ç”¢ç”Ÿæè¿°å¾Œï¼Œç¨‹å¼æœƒå¼·åˆ¶åœ¨çµå°¾é™„åŠ å³ä¾¿ã€Œå®‰å…¨å¾Œç¶´ã€ï¼š

```text
, cute kid-friendly style, soft colors, warm lighting, vector art, 3d render style, G-rated, masterpiece, best quality, no text, no scary elements
```

*   **cute kid-friendly style**: å¼·åˆ¶å¯æ„›é¢¨æ ¼ã€‚
*   **soft colors, warm lighting**: é¿å…é™°æš—ã€é«˜å°æ¯”çš„ææ€–æ°›åœã€‚
*   **vector art, 3d render**: é¿å…éŽåº¦å¯«å¯¦çš„ç…§ç‰‡é¢¨æ ¼ã€‚
*   **G-rated**: ç¾Žåœ‹é›»å½±åˆ†ç´šçš„æ™®éç´šã€‚
*   **no scary elements**: æ˜Žç¢ºç¦æ­¢ææ€–å…ƒç´ ã€‚
*   **no text**: å¼·åˆ¶ç¦æ­¢åœ–ç‰‡ä¸­å‡ºç¾æ–‡å­— (DALL-E 3 å¸¸è¦‹å•é¡Œ)ã€‚

---

## 3. è³‡æ–™æµå‘åœ– (Data Flow)

**æ­£å¸¸æµç¨‹**:
`User Query` -> `Check DB` -> `Found?` -> `Return Image`

**æª¢èˆ‰å¾Œæµç¨‹**:
1. `User Report` -> `Votes++`
2. `Votes >= 3` -> **ARCHIVE TRIGGERED**
3. `Move DB Doc` -> `mnemonic_generations_archive`
4. `Move GitHub File` -> `public/library/archive/`
5. `Delete Main Doc`
6. `User Query (Retry)` -> `Check DB` -> `Not Found` -> **NEW GENERATION**

---

## 4. åˆ†æžèˆ‡å„ªåŒ– (Future Analysis)
ç”±æ–¼ä¿ç•™äº†å®Œæ•´çš„å°å­˜è³‡æ–™ (Prompt, Analysis, Image)ï¼Œé–‹ç™¼è€…å¯å®šæœŸæª¢è¦– `_archive` é›†åˆï¼š
*   **åˆ†æžèª¤åˆ¤**ï¼šæ˜¯å¦æŸäº›å–®å­—å®¹æ˜“ç”¢ç”Ÿæ­§ç¾©ï¼Ÿ
*   **å„ªåŒ– Prompt**ï¼šæ ¹æ“šè¢«æª¢èˆ‰çš„åœ–ç‰‡ç‰¹å¾µï¼Œèª¿æ•´ System Prompt æˆ– Safety Suffixã€‚

---

## 5. ç³»çµ±è‡ªæˆ‘ä¿®å¾©èˆ‡ç¶­è­· (System Self-Healing)

ç‚ºäº†é¿å…å› ç”ŸæˆéŽç¨‹ä¸­æ–·ï¼ˆå¦‚ Pollinations è¶…æ™‚ã€ç¶²è·¯å•é¡Œï¼‰å°Žè‡´è³‡æ–™åº«ç•™ä¸‹ç„¡åœ–ç‰‡çš„ã€Œå¹½éˆè³‡æ–™ (Ghost Data)ã€ï¼Œç³»çµ±å¯¦ä½œäº†ä»¥ä¸‹æ©Ÿåˆ¶ï¼š

### å£žè³‡æ–™å®šç¾© (Definition)
ç¬¦åˆä»¥ä¸‹æ‰€æœ‰æ¢ä»¶è€…è¦–ç‚ºå£žè³‡æ–™ï¼š
*   **ç‹€æ…‹**ï¼š`planned` (å·²ç­–åŠƒä½†æœªå®Œå·¥)ã€‚
*   **åœ–ç‰‡æ¬„ä½**ï¼š`generated_image_url` ç‚ºç©ºã€‚
*   **å»ºç«‹æ™‚é–“**ï¼šè¶…éŽ **10 åˆ†é˜** (è¦–ç‚ºè¶…æ™‚)ã€‚

### ä¿®å¾©æ©Ÿåˆ¶ (Recovery Strategy)

1.  **å³æ™‚æ””æˆª (Just-in-Time Healing)**
    *   **è§¸ç™¼é»ž**ï¼šä½¿ç”¨è€…æŸ¥è©¢å–®å­— (`getOrGenerate`)ã€‚
    *   **é‚è¼¯**ï¼šè‹¥ç³»çµ±ç™¼ç¾å°æ‡‰çš„è³‡æ–™ç¬¦åˆä¸Šè¿°ã€Œå£žè³‡æ–™ã€å®šç¾©ï¼Œæœƒ**è‡ªå‹•å¿½ç•¥**è©²ç­†ç´€éŒ„ï¼Œè¦–ç‚ºã€Œç„¡è³‡æ–™ã€ï¼Œä¸¦ç«‹å³è§¸ç™¼ä¸€æ¬¡å…¨æ–°çš„ç”Ÿæˆæµç¨‹ã€‚

2.  **èƒŒæ™¯æ¸…ç† (Background Cleanup)**
    *   **æœå‹™**ï¼š`GhostCleanupService`ã€‚
    *   **æ“ä½œ**ï¼šç®¡ç†å“¡å¯é€éŽ API (`POST /kids-v2/cleanup`) è§¸ç™¼ã€‚
    *   **æµç¨‹**ï¼šæŽƒææ‰€æœ‰å£žè³‡æ–™ -> è¤‡è£½åˆ° `mnemonic_ghosts_archive` -> å¾žä¸»è³‡æ–™åº«åˆªé™¤ã€‚

